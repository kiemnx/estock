var imgDefault=s3Storage+"/Themes/TheCodeCampPro/Resources/Images/flags/flag-default.svg";$.Leaderboard=function(n){function h(){var i=t.$fromTime.datepicker("isValid"),n;return t.$fromTime.next(".error-tooltip").html(i?"":translate.instant("LEADERBOARD_VALIDATION_MESSAGE_INVALID_DATE")),n=t.$toTime.datepicker("isValid"),t.$toTime.next(".error-tooltip").html(n?"":translate.instant("LEADERBOARD_VALIDATION_MESSAGE_INVALID_DATE")),i&n}function y(n){t.$fromTime.toggle(n);t.$toTime.toggle(n)}function p(n){var i,r;n.length>1&&(i=n[0],n[0]=n[1],n[1]=i);r=n.map(function(n){var t="last-week-rank rank-"+n.Rank,i=[{Name:"Country",IconUrl:n.CountryIconUrl,ToolTip:n.CountryName}],r=i.map(function(n){var t=n.ToolTip?"data-tooltip='"+n.ToolTip+"'":"";return"<div class='ubadge simple-tooltip topside' "+t+"><img onerror='this.src=\""+imgDefault+"\"' src='"+s3Storage+n.IconUrl+"'/><\/div>"}).join("");return"<div class='col-md-4'>                         <div class='"+t+"'>                             <div class='avatars'><img class='level-avatar' src='"+s3Storage+n.UserExpLevel.IconUrl+"'/><img class='user-avatar' src='"+s3Storage+n.UserAvatarUrl+"'/><\/div>                             <div class='username'><a href='"+n.UserUrl.toLowerCase()+"' title='"+n.UserName+"'>"+n.UserName+"<\/a><\/div>                             <div class='badges'>"+r+"<\/div>                             <div class='footer'><div class='total-exp'><span>"+translate.instant("LEADERBOARD_LABEL_TOTAL_XP")+":<\/span > <span class='exp'>"+n.TotalExp+"<\/span><\/div ><\/div >                         <\/div>                    <\/div>"});t.$lastWeekTops.html(r);t.$lastWeekTops.find(".country-info img").each(function(){this.fallbackImage(countryFlagBaseUrl+"flag-default.svg")})}function w(n){var t=n.CountryName?"data-tooltip='"+n.CountryName+"'":"",i=[{html:n.Rank,"class":"rank-no"},{html:"<div class='user-info'><div class='avatars'><img class='level-avatar' src='"+s3Storage+n.UserExpLevel.IconUrl+"'/><img class='user-avatar' src='"+s3Storage+n.UserAvatarUrl+"'/><\/div>                        <div class='info'><a title='"+n.UserName+"' href='"+n.UserUrl.toLowerCase()+"'>"+n.UserName+"<\/a><\/div><\/div>","class":"username"},{html:"<div class='country-info simple-tooltip topside' "+t+"><img src='"+s3Storage+n.CountryIconUrl+"'/><\/div>","class":"country"},{html:Math.round(n.TotalExp*100)/100,"class":"total-exp"}];return"<div class='tbrow'>"+i.map(function(n){return"<div class='tbcol "+n.class+"'>"+n.html+"<\/div>"}).join("")+"<\/div>"}function b(t){$(n.views.$listContainer).paging({pageSize:n.listPageSize,url:n.loadLeaderboardUri,data:t,fullLoading:!1,OnRender:function(n,t){var i="";i=n.length?n.map(w).join(""):"<div class='no-data'>"+translate.instant("USER_XP_HISTORY_MESSAGE_NO_DATA")+"<\/div>";t.html(i);setTimeout(function(){checkVerScrollBarDisplay()},500);t.find(".country-info img").each(function(){this.fallbackImage(countryFlagBaseUrl+"flag-default.svg")})}})}function r(){var n={FromDate:t.$fromTime.val(),ToDate:t.$toTime.val(),SearchText:t.$searchBox.val(),Period:e,TimezoneOffset:v,PreloadRankLookup:!0};b(n)}function k(){$.get(n.loadLastWeekLeaderboardUri,"",function(n){p(n.Data)})}var u,f,a={resourceUrlPrefix:"",loadLeaderboardUri:null,get loadLastWeekLeaderboardUri(){return u||(u=this.loadLeaderboardUri.replace(/\/[^/]+$/,"/LoadLeaderboardLastWeek")),u},set loadLastWeekLeaderboardUri(n){u=n},get exportLeaderboardUri(){return f||(f=this.loadLeaderboardUri.replace(/\/[^/]+$/,"/ExportLeaderboard")),f},set exportLeaderboardUri(n){f=n},listPageSize:20,views:{$listContainer:null,$lastWeekTops:null,$searchBox:null,$timeRangePills:null,$fromTime:null,$toTime:null,$exportButton:null}},i,l;n=$.extend(a,n);var t=n.views,v=(new Date).getTimezoneOffset(),e=4,o,c=$.datepicker.regional[""],s={vn:["dd/mm/yyyy","dd/mm/yy"],en:["mm/dd/yyyy","mm/dd/yy"]}[LANG_CURRENT]||["mm/dd/yyyy","mm/dd/yy"];LANG_CURRENT=="vn"&&(c=$.datepicker.regional.vi);i={dateFormat:s[1],onSelect:function(){h()&&r()}};i=$.extend({},c,i);t.$fromTime.datepicker(i);t.$toTime.datepicker(i);t.$fromTime.hide();t.$toTime.hide();t.$timeRangePills&&t.$timeRangePills.click(function(){var u=$(this).data("period"),i=u==5;if(i){o=!0;var n=new Date,f=[new Date(n.getFullYear(),n.getMonth(),n.getDate()),n.setDate(n.getDate()-(n.getDay()||7)+1)&&n,new Date(n.getFullYear(),n.getMonth(),1),new Date(n.getFullYear(),0,1)],s=f[e]||new Date;t.$fromTime.datepicker("setDate",s);t.$toTime.datepicker("setDate",new Date);h();o=!1}y(i);e=u;i||r()});t.$exportButton&&t.$exportButton.click(function(){});t.$fromTime.attr("placeholder",s[0]);t.$toTime.attr("placeholder",s[0]);$([t.$fromTime[0],t.$toTime[0]]).change(function(){if(!o){var n=h();n&&r()}});t.$searchBox.on("input",function(){clearTimeout(l);l=setTimeout(r,300)});k();r()};
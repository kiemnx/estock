function GetArrIds(){var n=$('#list-notify li.isRead[value="false"]'),t;n.length>0&&(t=n.map(function(){arrIds.push($(this).attr("id"))}).get())}function readNotice(){$("#list-notify li.isRead").click(function(){var n=$(this).attr("id"),t=$(this).attr("value")=="false",i=$(this).attr("href");t&&$.ajax({type:"Get",url:apiNotify.read+"?NoticeId="+n,timeout:2e3,success:function(){}});location.href=i})}function SetReadNotic(n){n=n+"?ids="+arrIds.toString();$.ajax({type:"Get",url:n,timeout:2e3,success:function(){}});getUnReadCount()}function getUnReadCount(){$.get(apiNotify.unRead,updateUnreadCount)}function loadTopNotification(){$.get(apiNotify.top,function(n){var r=n.Data,u,i,t;if(r)if(r.length==0)$("#list-notify li.header").html(translate.instant("NOTIFICATION_LABEL_NOTI"));else{for(u="",i=0;i<r.length;i++)if(t=r[i],u+="<li id='"+t.NoticeId+"' href='"+t.ContentUrl+"' class='isRead' value='"+(t.ReadState==2)+"'><a href='"+t.ContentUrl+"'>"+t.Title+"<\/a><\/li >",i>9)break;$("#list-notify li.isRead").remove();$("#list-notify li.header").after(u);GetArrIds();readNotice();$("#notification-count").hide()}})}function SetReadNotic(n){n=n+"?ids="+arrIds.toString();$.ajax({type:"Get",url:n,timeout:2e3,success:function(){}});getUnReadCount()}function updateUnreadCount(n){n!=0?($("#notification-count").show(),n>99?($("#notification-count").addClass("label label-warning"),$("#notification-count").html("99+")):($("#notification-count").addClass("label label-warning"),$("#notification-count").html(n))):($("#notification-count").removeClass("label label-warning"),$("#notification-count").hide())}function getQueryVariable(n){for(var u=window.location.search.substring(1),r=u.split("&"),t,i=0;i<r.length;i++)if(t=r[i].split("="),t[0]==n)return unescape(t[1])}var arrIds=[],apiNotify={unRead:"/Notification/GetTotalUnreadNotices",read:"/Notification/SetNoticeRead",top:"/Notification/Top",index:"/Notification/Index"};$(function(){$("#notify").click(function(){loadTopNotification()});var t=$.connection.notifyHub,n=getQueryVariable("transport")||"auto",i=getQueryVariable("jsonp")==="true",r={transport:n};isGetNotification&&getUnReadCount()});
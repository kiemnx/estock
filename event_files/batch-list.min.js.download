function buildFilter(){var n={"filter.Name":$("#search-batch").val(),"filter.StatusId":$("#search-batch-status").val(),"filter.BatchType":batch_type,"filter.ShareKey":$("#share-key").val()};return"?"+jQuery.param(n)}function searchBacth(){$("#search-batch").val("");$("#search-batch").keyup(function(n){if(isUpdateHot=!1,isLoadPage=!1,n.keyCode===13||$(this).val()==""){var t=$("#share-key").val();t.length>0&&t.length<4?$.notify(translate.instant("SERVER_MSG_2057"),{type:"warning",delay:5e3}):(urlFilter=buildFilter(),$.CCHomeWidget())}});$("#share-key").keyup(function(n){if(n.keyCode===13||$(this).val()==""){urlFilter=buildFilter();isUpdateHot=!1;var t=$("#share-key").val();t.length>0&&t.length<4?$.notify(translate.instant("SERVER_MSG_2057"),{type:"warning",delay:5e3}):(isLoadPage=!1,$.CCHomeWidget())}});$(document).on("click","#search.head-batch-list .input-group .input-group-addon.btn",function(){var n;$("#share-key").is(":hidden")?(isUpdateHot=!1,isLoadPage=!1,n=$("#share-key").val(),n.length>0&&n.length<4?$.notify(translate.instant("SERVER_MSG_2057"),{type:"warning",delay:5e3}):(urlFilter=buildFilter(),$.CCHomeWidget())):(urlFilter=buildFilter(),isUpdateHot=!1,n=$("#share-key").val(),n.length>0&&n.length<4?$.notify(translate.instant("SERVER_MSG_2057"),{type:"warning",delay:5e3}):(isLoadPage=!1,$.CCHomeWidget()))})}function searchBatchType(){$(document).on("click",".tab-form-control a:not(.create)",function(n){if(n.preventDefault(),!$(this).hasClass("active")){$(".tab-form-control a.active").removeClass("active");$(this).addClass("active");$("#share-key").val("");$("#search-batch").val("");batch_type=$(this).data("value");batch_type==0?$("#share-key").hide():$("#share-key").show();var t=$("#share-key").val();t.length>0&&t.length<4?$.notify(translate.instant("SERVER_MSG_2057"),{type:"warning",delay:5e3}):(urlFilter=buildFilter(),isUpdateHot=!1,isLoadPage=!1,$.CCHomeWidget())}})}function searchStatus(){$("#search-batch-status").change(function(){urlFilter=buildFilter();isUpdateHot=!1;isLoadPage=!1;$.CCHomeWidget()})}function GetMembersByTeamId(n,t,i){var u,f,r;if(i==null||i.length==0)return null;u=[];for(f in i)r=i[f],r.BatchId==n&&r.TeamId==t&&r.UserId!=0&&u.push(r);return u}function GetUserFromUserList(n,t){var i,r;if(t==null||t.length==0)return null;i=null;for(r in t)if(t[r].TeamId==n){i=t[r];break}return i}function getShortText(n,t,i="..."){return n.length<=t?n:n.substr(0,t)+i}function htmlDecode(n){var t=document.createElement("textarea");return t.innerHTML=n,t.childNodes.length===0?"":t.childNodes[0].nodeValue}var api={listFights:"api/fights/getListBatch",cancelRegister:"api/fights/cancelBatchRegisted",registerBacth:"api/fights/batchUserRegester",getListTeam:"api/team/getTeamByUser",checkuserprofile:"api/Information/checkUserProfileCurent",fightsDetail:"/fights/detail/",imgNotFound:resourcePath+"/Images/code-learn/not-found.svg",defaultUserAvatar:resourcePath+"/Images/code-learn/avatar-default.svg",defaultCup:resourcePath+"/Images/default-cup.svg"},batchId=0,isTeam=!0,urlFilter="",isUpdateHot=!0,isLoadPage=!0,batch_type=0;$.CCHomeWidget=function(n){n=$.extend({selectorBatchFirst:".batch__top",panel:".section__batch__list",template:"#codecamp__render__batch__list"},n);var r=function(n){return n=n&&n.split(",")||[],_tags=[],n.length>0&&n.forEach(function(n){_tags.push('<span class="tag tag-default">'+n+"<\/span>")}),_tags.join("")},u=function(n,t){var i=n.IsTeam;return i?f(n,t):e(n,t)},f=function(n,t){var u=n.TopScoreBatch,i="",r,e,s;if(u==null||u.length==0)return"";for(r=0;r<u.length;r++){if(r+1>3)break;var f=GetMembersByTeamId(n.Id,u[r].Id,t),h=htmlDecode(u[r].Name),o="members-1";if(f!=null&&(o="members-"+f.length,f.length>4&&(o="members-4")),i+='<div class="item" data-batch-id="'+n.Id+'" data-team-id="'+u[r].Id+'" data-team-name="'+u[r].Name+'">',i+='<div class="avatar '+o+'">',f==null)i+='<img src="'+api.defaultUserAvatar+'" alt="">';else for(e=0;e<f.length;e++){if(e>4)break;s=s3Storage+f[e].CreatorAvatarUrl;i+='<img src="'+s+'" alt="" onerror="this.src=\''+api.defaultUserAvatar+"'\">"}i+="<\/div>";i+='<div class="info">';i+="<span>"+getShortText(h,12)+"<\/span>";i+='<p><img class="top-item" src="'+resourcePath+"/Images/code-learn/top"+r+'.svg?id=2" /><\/p>';i+="<\/div>";i+="<\/div>"}return i+'<div class="clrb"><\/div>'},e=function(n,t){var f=n.TopScoreBatch,i="",r,u,e,o;if(f==null||f.length==0)return i;for(r=0;r<f.length;r++){if(r+1>3)break;u=GetUserFromUserList(f[r].Id,t);u!=null&&(e=s3Storage+u.UserExpLevel.IconUrl,o=s3Storage+u.CreatorAvatarUrl,i+='<div class="item" data-id="'+u.TeamId+'">',i+='<div class="avatar">',i+='<img src="'+e+'" class="level-avatar" alt="">',i+='<img src="'+o+'" class="user-avatar" alt="" onerror="this.src=\''+api.defaultUserAvatar+"'\">",i+="<\/div>",i+='<div class="info">',i+="<span>"+getShortText(u.UserName,12)+"<\/span>",i+='<p><img class="top-item" src="'+resourcePath+"/Images/code-learn/top"+r+'.svg?id=2" /><\/p>',i+="<\/div>",i+="<\/div>")}return i+'<div class="clrb"><\/div>'},o=function(n,t){var i=statusAndNameBatch(n),r='<div class="batch__actions col-md-3 '+i.Status+'">';return n.BatchStatusId!=4&&n.IsWaitingApprove?r+='<p><span class="batch__status waiting_approve">'+translate.instant("CONTEST_WAITING_APPROVE")+"<\/span><\/p>":n.BatchStatusId==4?(r+='<p><span class="timer">'+n.EndTimeCode.split(" ")[0]+"<\/span><\/p>",r+='<p><span class="batch__status '+i.Status+'">'+i.Text+"<\/span><\/p>"):(r+="<p>",r+=$.fn.isVal(i.Time,0,"",'<span class="batch__timer timer-to-register" data-toggle="tooltip" data-placement="bottom" title="'+translate.instant("SYSTEM_STATUS_TIME_REGISTER")+'" row="'+t+'" data="'+i.Time+'">'+translate.instant("SYSTEM_STATUS_LOADING")+"<\/span>"),r+="<\/p>",r+=n.BatchStatusId==3?'<p><span class="batch__status '+i.Status+'">'+i.Text+"<\/span><\/p>":'<p><span isteam="'+n.IsTeam+'" batch-id="'+n.Id+'" class="batch__status '+i.Status+'">'+i.Text+"<\/span><\/p>"),r+"<\/div>"},s=function(){$(".batch-item").click(function(){location.href=api.fightsDetail+$(this).attr("batch-id")})},t=!1,h=function(n){$(".popover").hide();var i={trigger:"manual",html:!0,animation:!1,container:"body",placement:"auto bottom"};$(".top-users .item .avatar").popover($.extend(i,{content:function(){return $("#user-info").html()}}));$(".top-teams .item .avatar").popover($.extend(i,{content:function(){return $("#team-info").html()}}));$(".top-teams .item .avatar, .top-users .item .avatar").popover(i).on("shown.bs.popover",function(){$(".top-teams .item .avatar, .top-users .item .avatar").not(this).popover("hide")});$(".top-users").on("mouseenter",".item",function(i){var f,r,e,u;if(i.preventDefault(),t=!0,f=$(this).attr("data-id"),r=GetUserFromUserList(f,n),r==null){t=!1;return}e=$(this).children(".avatar");u=$("#user-info");$(".level-avatar",u).attr("src",s3Storage+r.UserExpLevel.IconUrl);$(".user-avatar",u).attr("src",s3Storage+r.CreatorAvatarUrl);$(".user-name a",u).attr("href","/profile/"+r.TeamId).text(r.UserName);$(".point-exp span",u).text(r.UserExpLevel.CurrentUserExperiencePoint);e.popover("show")}).on("mouseover",".item",function(){$(this).children(".avatar").popover("show")}).on("mouseleave",".item",function(){var n=$(this).children(".avatar");t=!1;window.setTimeout(function(){t||n.popover("hide")},500)});$("body").on("mouseover",".popover",function(n){n.preventDefault();n.stopPropagation();t=!0;$(this).show()}).on("mouseleave",".popover",function(){t=!1;window.setTimeout(function(){t||$(this).hide()},500);$(this).hide()});$(".top-teams").on("mouseenter",".item",function(i){var s,u,o,f,r;i.preventDefault();t=!0;var h=$(this).attr("data-batch-id"),c=$(this).attr("data-team-id"),l=$(this).attr("data-team-name"),e=GetMembersByTeamId(h,c,n);if(e==null||e.length==0){t=!1;return}for(s=$(this).children(".avatar"),u=$("#team-info"),$(".info-row",u).remove(),$(".team-name span",u).text(l),o=0;o<e.length;o++)f=e[o],r=$(".template-row",u).clone(),r.removeClass("template-row").addClass("info-row"),$(".level-avatar",r).attr("src",s3Storage+f.UserExpLevel.IconUrl),$(".user-avatar",r).attr("src",s3Storage+f.CreatorAvatarUrl),$(".user-name a",r).attr("href","/profile/"+f.UserId).text(f.UserName),$(".point-exp span",r).text(f.UserExpLevel.CurrentUserExperiencePoint),r.insertBefore($(".template-row",u));$(".info-row:last",u).css("border","none");s.popover("show")}).on("mouseover",".item",function(){$(this).children(".avatar").popover("show")}).on("mouseleave",".item",function(){var n=$(this).children(".avatar");t=!1;window.setTimeout(function(){t||n.popover("hide")},500)})},i="";isLoadPage||(i=buildFilter());$(".section__batch__list").paging({url:api.listFights+i,fullLoading:!0,urlRender:!1,OnRender:function(t,i){var k=$(n.template).html(),y,f,p,a,l,e,b,d,v;if(t.ListBatchs.length>0){if(y=t.ListBatchs.map(function(n){return n.IsHot}).indexOf(!0),f=t.ListBatchs[y>-1?y:0],HTML_BATCH_FIRST="",HTML_BATCH_LIST=[],f&&isUpdateHot){isUpdateHot=!1;$("#team-or-user").text(f.IsTeam==!0?translate.instant("HOME_LABEL_TEAM"):translate.instant("HOME_LABEL_USER"));f.ImagePoster&&(p=s3Storage+f.ImagePoster.replace("~",""),a=new Image,a.src=p,a.onload=function(){$(n.selectorBatchFirst).css({"background-image":"url('"+p+"')",height:"100 %","background-repeat":"no-repeat","background-size":"contain","background-position":"center","background-size":"cover"})},a.onerror=function(n){console.log(n)});var c=statusAndNameBatch(f),g=(new Date).getTime(),w=" ";c.Status=="status_finish"&&(w+=f.EndTimeCode.split(" ")[0],$("#lb-timeout").remove(),$("#wait-loading").remove());$("#number-user").text(f.CountUser+(f.LimitRegister>0?"/"+f.LimitRegister:""));$("#batch-status").text(c.Text+w).addClass(c.Status);c.Time>0?($("#wait-loading").remove(),startTimer(c.Time,$("#cal-time"),!0,function(){location.reload()})):$("#wait-loading").text("--");$(n.selectorBatchFirst).click(function(){window.location.href=api.fightsDetail+f.Id})}for(t.ListBatchs.forEach(function(n,i){var f=n.IsTeam?"top-teams":"top-users";HTML_BATCH_LIST.push('<div batch-id="'+n.Id+'" class="col-md-12 batch-item">                                <div class="batch__infomation col-md-8">                                    <div class="media">                                        <div class="media-left icon-cup">                                            <a href="'+api.fightsDetail+n.Id+'">                                                <img class="media-object" src="'+(n.ImageIcon!=""?s3Storage+n.ImageIcon.replace("~",""):api.defaultCup)+'" />                                            <\/a>                                        <\/div>                                        <div class="media-body">                                            <h4 class="media-heading">                                                <a href="'+api.fightsDetail+n.Id+'">                                                    '+n.Name+'                                                <\/a>                                            <\/h4>                                            <p class="description">'+n.Description+' <\/p>                                            <div class="'+f+'">'+u(n,t.MemberContests)+' <\/div>                                            <p class="tag-info">'+r(n.Tags)+'<\/p>                                        <\/div>                                    <\/div>                                <\/div>                                <div class="batch__type col-md-1 text-center">                                '+(n.IsTeam?"<i class='img-team cl-icon-users-alt'><\/i>":"<i class='img-user cl-icon-user'><\/i>")+"                                "+(n.IsTeam?"<p>"+(n.CountUser>0?n.CountUser+" "+translate.instant("HOME_LABEL_TEAM"):"--")+"<\/p>":"<p>"+(n.CountUser>0?n.CountUser+" "+translate.instant("HOME_LABEL_USER"):"--")+"<\/p>")+"                                <\/div>                                "+o(n,i)+"                            <\/div > ")}),$(i).html(k.render({BATCH_LIST_RENDER:HTML_BATCH_LIST.join("")})),window.Element&&!Element.prototype.closest&&(Element.prototype.closest=function(n){var r=(this.document||this.ownerDocument).querySelectorAll(n),t,i=this;do for(t=r.length;--t>=0&&r.item(t)!==i;);while(t<0&&(i=i.parentElement));return i}),l=$(i).find(".batch__timer"),e=0;e<l.length;e++)b=$(l[e]).attr("data").getNumber(),d=$(l[e]).attr("row").getNumber(),startTimer(b,$(l[e].closest("p")),!0,function(){location.reload()})}else v='<div id="no-data"><img src="'+api.imgNotFound+'"/>',v+="<h2>"+translate.instant("COURSE_MESSAGE_01")+" !<\/h2><h3>"+translate.instant("COURSE_MESSAGE_02")+"<\/h3>",v+="<\/div>",$(".section__batch__list").empty().html(v);s();h(t.MemberContests);checkVerScrollBarDisplay()}})};$(document).ready(function(){isLoadPage&&$("#search-batch-status").val($("#search-batch-status option:first").val());translate.onLoad(function(){$.CCHomeWidget();searchBacth();searchStatus();searchBatchType()})});
var api={notFoundImageUrl:resourcePath+"/Images/code-learn/not-found.svg",urlDetailPost:'/discussion/topic/',changeStatusPost:'discussion/changestatuspost'};$.UseForum=function(options){var _saveForumThreadUri;var _saveForumPostUri;var _deleteForumThreadUri;var _loadModuleContextUri;var _loadAllVoteThreadUri;var _threadId=[];var _manager=false;var defaultOptions={threadsContainerSelector:"",pageSize:10,getForumThreadsUri:"",searchInputSelector:"",manager:'',get saveForumThreadUri(){if(!_saveForumThreadUri){_saveForumThreadUri=this.getForumThreadsUri.replace(/\/[^/]+$/,"/SaveForumThread");}
return _saveForumThreadUri;},set saveForumThreadUri(value){_saveForumThreadUri=value;},get deleteForumThreadUri(){if(!_deleteForumThreadUri){_deleteForumThreadUri=this.getForumThreadsUri.replace(/\/[^/]+$/,"/DeleteForumThread");}
return _deleteForumThreadUri;},set deleteForumThreadUri(value){_deleteForumThreadUri=value;},get saveForumPostUri(){if(!_saveForumPostUri){_saveForumPostUri=this.getForumThreadsUri.replace(/\/[^/]+$/,"/SaveForumPost");}
return _saveForumPostUri;},set saveForumPostUri(value){_saveForumPostUri=value;},get loadModuleContextUri(){if(!_loadModuleContextUri){_loadModuleContextUri=this.getForumThreadsUri.replace(/\/[^/]+$/,"/LoadModuleContext");}
return _loadModuleContextUri;},set loadModuleContextUri(value){_loadModuleContextUri=value;},get loadAllVoteThreadUri(){if(!_loadAllVoteThreadUri){_loadAllVoteThreadUri=this.getForumThreadsUri.replace(/\/[^/]+$/,"/GetAllVoteThreadUri");}
return _loadAllVoteThreadUri;},set loadAllVoteThreadUri(value){_loadAllVoteThreadUri=value;},get loadThreadId(){return _threadId;},set loadThreadId(value){_threadId=value;}};options=$.extend(defaultOptions,options);_manager=(options.manager=='True');var searchInput=$(options.searchInputSelector);function loadThreads(searchText){if(searchText)searchText=encodeURI(searchText);var param={};param.searchText=searchText;if($('#search-state')){param.state=$('#search-state').val();}
var filter='?'+jQuery.param(param);$(options.threadsContainerSelector).paging({pageSize:options.pageSize,url:options.getForumThreadsUri+filter,fullLoading:true,OnRender:function(data,scope,pageInfo){var html="";if(data.length>0){html=data.map(function(e){e.ThreadUrl=api.urlDetailPost+e.Id;var tagsHtml=(e.Tags||"").split(',').map(function(e){return "<span class='tag-item'>"+e.trim()+"</span>";}).join("");_threadId.push(e.Id);var upButtonSrc="";var downButtonSrc="";var voteUpClass="";var voteDownClass="";if(e.UserVoteThread==1&&e.CountVoteThreadUp>0){upButtonSrc=resourcePath+"/Images/forum/user_vote_up.svg";downButtonSrc=resourcePath+"/Images/forum/down_vote.svg";voteUpClass="vote-number";voteDownClass="no-vote";}
else if(e.UserVoteThread==0&&e.CountVoteThreadDown>0){upButtonSrc=resourcePath+"/Images/forum/up_vote.svg";downButtonSrc=resourcePath+"/Images/forum/user_vote_down.svg";voteUpClass="no-vote";voteDownClass="vote-number";}else{upButtonSrc=resourcePath+"/Images/forum/up_vote.svg";downButtonSrc=resourcePath+"/Images/forum/down_vote.svg";voteUpClass="no-vote";voteDownClass="no-vote";}
let css_class="forum-thread";if(e.State==0){css_class+=" thead-blocked"}
var post="<div class='"+css_class+"'> \
                                    <div class='forum-thread-item'> \
                                        <div class='user-info-container'><div class='user-col'><a href='"+cvUrl+e.OpId+"'><div class='avatars'><img class='level-avatar' src='"+s3Storage+e.UserExpLevel.IconUrl+"'/><img class='user-avatar' src='"+s3Storage+e.OpAvatarUrl+"'/></div></a><div><span class='footer-button'><i id='upButton' class='cl-icon-vote-up vote-button-img-forum'></i></span><span class = ' "+voteUpClass+"'>"+" "+e.CountVoteThreadUp+"</span></div> \
                                                <div><span class='footer-button' ><i id='downButton' class='cl-icon-vote-down vote-button-img-forum'></i></span ><span class = '"+voteDownClass+"'>"+" "+e.CountVoteThreadDown+"</span></div> \
                                            </div><div><a href="+e.ThreadUrl+" class='forum-thread-title'>"+e.Title+"</a><div><div><span class='forum-thread-content'>"+e.Content+"</span></div></div><div class='thread-summary'><div>By <span class='created-by'><a href='"+cvUrl+e.OpId+"'>"+e.OpName+"</span><span class='category hide'>"+e.Category+"</a></span>"+translate.instant("FORUM_LABEL_LAST_UPDATE")+": <span class='last-update'>"+e.LastUpdatedInfo+"</span></div></div><div><div><div class='tags-container'>"+tagsHtml+"</div></div></div></div> \
                                                <div class='right-side-info'>\
                                                    <span class='shares-count hide'>"+e.SharesCount+"</span>\
                                                    <span class='cl-icon-comment-dots forum-posts-count-icon'></span><span class='posts-count'>"+e.PostsCount+"</span>\
                                                </div></div></div>";if(e.State==0&&!_manager){post+="<span class='blocked-content'>"+translate.instant("SELECT_VALUE_BLOCKED")+"</span>";}
if(_manager&&e.State==1){post+="<a class='unpublic-post pull-right btn btn-outline-danger' data-post-id='"+e.Id+"'><i class='cl-icon-eye-slash'></i>"+translate.instant("SELECT_ACTION_BLOCKED")+"</a> <br \>";}
post+="</div> ";return post;}).join("");}else{html="<div class='not-found' style='text-align: center; padding-bottom: 40px; background: white'><img width='40%' src='"+api.notFoundImageUrl+"'/><h2>"+translate.instant("COURSE_MESSAGE_01")+"!</h2 > <h3>"+translate.instant("COURSE_MESSAGE_02")+"</h3></div > ";$(options.threadsContainerSelector).html(html);}
scope.html(html);checkVerScrollBarDisplay();}});}
var delayedSearch;searchInput.keyup(function(e){var $this=$(this);if(e.keyCode===13||$(this).val()==''){loadThreads($this.val());}});$(document).on('click','.search-box.input-group .input-group-addon.btn',function(){loadThreads($('#search-box').val());}).on('click','.btn-filter',function(){loadThreads($('#search-box').val());});loadThreads();$(document).on('click','.unpublic-post',function(){if(confirm(translate.instant("BLOG_CONFIRM"))){var data={postId:parseInt($(this).attr('data-post-id')),};PKLService.post({url:api.changeStatusPost,data:JSON.stringify(data),contentType:"application/json; charset=utf-8",OnSuccess:function(response){var message='';if(response.Code==200){var state=response.Data;message=state?'SERVER_MSG_0028':'SERVER_MSG_0027';}
else{message=response.Message;}
if(NOFICATION_GLOBAL){NOFICATION_GLOBAL.update({message:translate.instant(message)});}else{NOFICATION_GLOBAL=$.notify(translate.instant(message));}
location.reload();}});}});}